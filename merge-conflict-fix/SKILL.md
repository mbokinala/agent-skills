---
name: merge-conflict-fix
description: Resolve git merge conflicts in a repository when the working tree is in a conflicted merge/rebase/cherry-pick state. Use when the user asks to fix conflicts, resolve merge issues, or complete a merge/rebase after conflicts. Ask the user for guidance whenever the correct resolution is ambiguous (e.g., conflicting values, design choices, or business logic).
---

# Merge Conflict Fix

## Overview

Resolve merge conflicts safely and interactively, asking the user for intent when choices are unclear.

## Workflow

1. Confirm the repo is in a conflicted state and identify the operation type.
- Check `git status` for "unmerged paths" and whether this is a merge, rebase, or cherry-pick.
- If no conflicts are present, stop and tell the user.

2. Enumerate conflicted files.
- Use `git status --porcelain` or `git diff --name-only --diff-filter=U`.
- Triage by impact: critical config/build files, code, then docs.

3. For each conflicted file, inspect and classify the conflict.
- Open the file and find conflict markers `<<<<<<<`, `=======`, `>>>>>>>`.
- Decide if the correct resolution is obvious (pure additions, non-overlapping changes, formatting-only, deterministic merges).
- If not obvious, ask the user a concrete question before changing anything.

4. Ask targeted questions when needed.
- Frame the question with concrete options and consequences.
- Example: "In `Button.tsx`, main uses label color `#1E40AF` and feature/xyz uses `#16A34A`. Which should we keep?"
- Do not guess design or business logic.

5. Apply the resolution.
- Edit the file to remove conflict markers and produce the intended merged result.
- Keep changes minimal and consistent with surrounding style.
- If there are multiple conflicts in one file, resolve all in one pass.

6. Verify and stage.
- Re-run `git status` to confirm conflicts are gone.
- If appropriate, run tests or a build step the user expects.
- Stage resolved files with `git add`.

7. Report progress and remaining items.
- Summarize what was resolved and list any remaining conflicts.
- If blocked on a user decision, pause and ask.

## Decision Rules

- Prefer deterministic merges when both sides change different lines or non-overlapping logic.
- If both sides change the same value or meaning, treat as ambiguous and ask.
- When the conflict is between autogenerated files and source, prefer source unless the repo pattern says otherwise.
- Never discard changes without explicit user approval.

## Example Prompts To Ask

- "In `app/theme.ts`, main sets `primary = '#0F172A'` and feature sets `primary = '#2563EB'`. Which color is intended?"
- "In `api/routes.ts`, main adds `/v1/users` and feature refactors to `/v2/users`. Should we keep v1, v2, or both?"
- "In `README.md`, main references `npm run dev` and feature changes to `pnpm dev`. Which command should we document?"
